
------ IN ORDER TO ANALYZE THE CUSTOMER LOYALITY
------ RANK CUSTOMERS BASED ON THE AVERAGE DAYS BETWEEN THEIR ORDERS

WITH customer_orders AS (
-- Customer C001
  SELECT 'ORD001' AS order_id, 'C001' AS customer_id, DATE '2024-01-01' AS order_date, 200 AS sales UNION ALL
  SELECT 'ORD002', 'C001', DATE '2024-01-15', 250 UNION ALL
  SELECT 'ORD003', 'C001', DATE '2024-02-01', 300 UNION ALL
  SELECT 'ORD004', 'C001', DATE '2024-02-20', 220 UNION ALL

  -- Customer C002
  SELECT 'ORD005', 'C002', DATE '2024-01-03', 180 UNION ALL
  SELECT 'ORD006', 'C002', DATE '2024-01-25', 230 UNION ALL
  SELECT 'ORD007', 'C002', DATE '2024-03-01', 310 UNION ALL
  SELECT 'ORD008', 'C002', DATE '2024-03-20', 290 UNION ALL

  -- Customer C003
  SELECT 'ORD009', 'C003', DATE '2024-01-05', 120 UNION ALL
  SELECT 'ORD010', 'C003', DATE '2024-01-06', 130 UNION ALL
  SELECT 'ORD011', 'C003', DATE '2024-01-07', 125 UNION ALL
  SELECT 'ORD012', 'C003', DATE '2024-01-09', 135 UNION ALL

  -- Customer C004
  SELECT 'ORD013', 'C004', DATE '2024-01-10', 210 UNION ALL
  SELECT 'ORD014', 'C004', DATE '2024-02-01', 270 UNION ALL
  SELECT 'ORD015', 'C004', DATE '2024-03-10', 280 UNION ALL
  SELECT 'ORD016', 'C004', DATE '2024-04-15', 260 UNION ALL

  -- Customer C005
  SELECT 'ORD017', 'C005', DATE '2024-01-12', 190 UNION ALL
  SELECT 'ORD018', 'C005', DATE '2024-01-20', 200 UNION ALL
  SELECT 'ORD019', 'C005', DATE '2024-02-01', 210 UNION ALL
  SELECT 'ORD020', 'C005', DATE '2024-02-15', 195
)
SELECT 
  order_id,
  customer_id,
  sales,
  FIRST_VALUE(sales) OVER(PARTITION BY customer_id ORDER BY sales) AS Lowest_Sales,
  MIN(sales) OVER(PARTITION BY customer_id) AS Lowest_Sales_v2,
  LAST_VALUE(sales) OVER(PARTITION BY customer_id ORDER BY sales ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING) AS Highest_Sales,
  FIRST_VALUE(sales) OVER(PARTITION BY customer_id ORDER BY sales DESC) AS Highest_Sales_v2,
  MAX(sales) OVER(PARTITION BY customer_id) AS Highest_Sales_v3,
FROM customer_orders




